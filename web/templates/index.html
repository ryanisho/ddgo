<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Monitor Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .metric-card {
            transition: all 0.3s ease;
        }
        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900">System Monitor Dashboard</h1>
            <div id="lastUpdated" class="text-sm text-gray-500"></div>
        </div>
        <div id="metricsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </div>

    <script>
        function formatBytes(bytes, decimals = 2) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }

        function createMetricCard(title, content, className = '') {
            const card = document.createElement('div');
            card.className = `bg-white rounded-lg shadow-sm p-6 metric-card ${className}`;
            card.innerHTML = `<h2 class="text-xl font-semibold mb-4 text-gray-800">${title}</h2>${content}`;
            return card;
        }

        function createProgressBar(value, max = 100, color = "blue") {
            const percentage = (value / max) * 100;
            const progressBar = document.createElement('div');
            progressBar.className = 'w-full bg-gray-200 rounded-full h-2';
            progressBar.innerHTML = `<div class="bg-${color}-600 rounded-full h-2" style="width: ${percentage}%"></div>`;
            return progressBar;
        }

        async function fetchMetrics() {
            try {
                const response = await fetch('http://localhost:8080/api/metrics');
                const data = await response.json();
                updateMetrics(data);
            } catch (error) {
                console.error(error);
            }
        }

        function updateMetrics(metrics) {
            document.getElementById("lastUpdated").textContent = `Last updated: ${new Date(metrics.time).toLocaleTimeString()}`;

            const metricsGrid = document.getElementById('metricsGrid');
            metricsGrid.innerHTML = '';

            // CPU Usage Card
            const cpuContent = metrics.cpu.cores.map(core => `
                <div>
                    <div class="flex justify-between mb-1">
                        <span class="text-gray-600">Core ${core.core}</span>
                        <span class="font-medium">${core.usage.toFixed(1)}%</span>
                    </div>
                    ${createProgressBar(core.usage, 100, core.usage > 80 ? "red" : core.usage > 60 ? "yellow" : "blue").outerHTML}
                </div>
            `).join('');
            metricsGrid.appendChild(createMetricCard("CPU Usage", cpuContent, "col-span-1 lg:col-span-2"));

            // Memory Usage Card
            const memoryContent = `
                <div>
                    <div class="flex justify-between mb-1">
                        <span class="text-gray-600">RAM Usage</span>
                        <span class="font-medium">${metrics.memory.virtual.usage.toFixed(1)}%</span>
                    </div>
                    ${createProgressBar(metrics.memory.virtual.usage, 100, metrics.memory.virtual.usage > 80 ? "red" : "blue").outerHTML}
                    <div class="mt-2 grid grid-cols-2 gap-4 text-sm">
                        <div><span class="text-gray-500">Used</span><div class="font-medium">${formatBytes(metrics.memory.virtual.used)}</div></div>
                        <div><span class="text-gray-500">Total</span><div class="font-medium">${formatBytes(metrics.memory.virtual.total)}</div></div>
                        <div><span class="text-gray-500">Free</span><div class="font-medium">${formatBytes(metrics.memory.virtual.free)}</div></div>
                        <div><span class="text-gray-500">Usage</span><div class="font-medium">${formatBytes(metrics.memory.virtual.usage)}</div></div>
                        <div><span class="text-gray-500">Cached</span><div class="font-medium">${formatBytes(metrics.memory.virtual.cached)}</div></div>
                        <div><span class="text-gray-500">Avaliable</span><div class="font-medium">${formatBytes(metrics.memory.virtual.available)}</div></div>
                        <div><span class="text-gray-500">Swap Total</span><div class="font-medium">${formatBytes(metrics.memory.swap.total)}</div></div>
                        <div><span class="text-gray-500">Swap Used</span><div class="font-medium">${formatBytes(metrics.memory.swap.used)}</div></div>
                        <div><span class="text-gray-500">Swap Free</span><div class="font-medium">${formatBytes(metrics.memory.swap.free)}</div></div>
                        <div><span class="text-gray-500">Swap Usage</span><div class="font-medium">${formatBytes(metrics.memory.swap.usage)}</div></div>

                    </div>
                </div>
                ${metrics.memory.swap.total > 0 ? `
                <div>
                    <div class="flex justify-between mb-1">
                        <span class="text-gray-600">Swap Usage</span>
                        <span class="font-medium">${metrics.memory.swap.usage.toFixed(1)}%</span>
                    </div>
                    ${createProgressBar(metrics.memory.swap.usage, 100, metrics.memory.swap.usage > 50 ? "yellow" : "green").outerHTML}
                </div>` : ''}
            `;
            metricsGrid.appendChild(createMetricCard("Memory Usage", memoryContent));

            // Disk Usage Card
            const diskContent = `
                <div>
                    <div class="flex justify-between mb-1">
                        <span class="text-gray-600">Usage</span>
                        <span class="font-medium">${metrics.disk.usage.toFixed(1)}%</span>
                    </div>
                    ${createProgressBar(metrics.disk.usage, 100, metrics.disk.usage > 85 ? "red" : "green").outerHTML}
                    <div class="mt-2 grid grid-cols-2 gap-4 text-sm">
                        <div><span class="text-gray-500">Total Space</span><div class="font-medium">${formatBytes(metrics.disk.total)}</div></div>
                        <div><span class="text-gray-500">Free Space</span><div class="font-medium">${formatBytes(metrics.disk.free)}</div></div>
                        <div><span class="text-gray-500">Read Count</span><div class="font-medium">${formatBytes(metrics.disk.io.read_count)}</div></div>
                        <div><span class="text-gray-500">Write Count</span><div class="font-medium">${formatBytes(metrics.disk.io.write_count)}</div></div>
                        <div><span class="text-gray-500">Read Bytes</span><div class="font-medium">${formatBytes(metrics.disk.io.read_bytes)}</div></div>
                        <div><span class="text-gray-500">Write Bytes</span><div class="font-medium">${formatBytes(metrics.disk.io.write_bytes)}</div></div>

                    </div>
                </div>
            `;
            metricsGrid.appendChild(createMetricCard("Disk Usage", diskContent));

            // System Info Card
            const systemInfoContent = `
                <div class="flex justify-between"><span class="text-gray-600">Physical Cores</span><span class="font-medium">${metrics.cpu.info.physical_cores}</span></div>
                <div class="flex justify-between"><span class="text-gray-600">Logical Cores</span><span class="font-medium">${metrics.cpu.info.logical_cores}</span></div>
                <div class="flex justify-between"><span class="text-gray-600">Total Processes</span><span class="font-medium">${metrics.cpu.info.process_count}</span></div>
                <div class="flex justify-between"><span class="text-gray-600">Total Threads</span><span class="font-medium">${metrics.cpu.info.thread_count}</span></div>
                <div class="flex justify-between"><span class="text-gray-600">CPU Load (1 minute)</span><span class="font-medium">${metrics.cpu.load['1m']}</span></div>
                <div class="flex justify-between"><span class="text-gray-600">CPU Load (5 minute)</span><span class="font-medium">${metrics.cpu.load['5m']}</span></div>
                <div class="flex justify-between"><span class="text-gray-600">CPU Load (15 minute)</span><span class="font-medium">${metrics.cpu.load['15m']}</span></div>

            `;
            metricsGrid.appendChild(createMetricCard("System Information", systemInfoContent));

            // Load Averages Card
            const loadAveragesContent = `
                <div class="flex justify-between items-center"><span class="text-gray-600">1 minute</span><span class="font-medium">${metrics.cpu.load.oneMin.toFixed(2)}</span></div>
                <div class="flex justify-between items-center"><span class="text-gray-600">5 minutes</span><span class="font-medium">${metrics.cpu.load.fiveMin.toFixed(2)}</span></div>
                <div class="flex justify-between items-center"><span class="text-gray-600">15 minutes</span><span class="font-medium">${metrics.cpu.load.fifteenMin.toFixed(2)}</span></div>
            `;
            metricsGrid.appendChild(createMetricCard("Load Averages", loadAveragesContent));
        }

        setInterval(fetchMetrics, 2000);
        fetchMetrics();
    </script>
</body>
</html>
